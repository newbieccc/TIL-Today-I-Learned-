# # JSP프로그래밍

## 05. 요청과 응답

- 컴퓨터과학과 김희천 교수님

### (1) 요청과 응답

- 요청
    - 클라이언트가 서버에 특정 작업(페이지 전송, 데이터 조회 등)을 요청하는 것
    - JSP에서 request 객체는 클라이언트의 요청 정보를 제공하는 내장 객체
- 응답
    - 요청 처리에 대한 결과를 서버가 클라이언트로 전송하는 것
    - JSP 에서 response 객체는 응답을 제공하기 위한 내장 객체
- 요청과 응답 처리에 사용되는 내장 객체
    - request 객체
        - 웹 컨테이너는 request 객체를 생성하여 서블릿의 서비스 메서드에 제공
            - HTTP 요청 헤더, 파라미터, 몸체 등의 정보를 가짐
        - 서블릿이나 JSP 코드에서 request 객체를 사용해 요청 정보를 읽어 처리
    - response 객체
        - 서블릿이나 JSP 코드에서 response 객체를 이용해 응답 내용(상태 코드, 응답 헤더, 본문 데이터)을 작성
        - 웹 컨테이너가 response 객체의 내용을 HTTP 응답 메시지로 변환하여 클라이언트로 전송

### (2) request 내장 객체

- request 내장 객체 기능
    - request 내장 객체
        - 클라이언트의 요청을 표현하는 JSP 내장 객체
            - 요청이 오면 생성되고, 처리가 끝나면 소멸됨
        - HttpServletRequest 인터페이스를 구현한 객체
    - 주요 기능
        - 클라이언트와 서버 관련 정보 읽이
        - 클라이언트가 전송한 데이터 (파라미터) 읽기
        - 클라이언트가 전송한 헤더, 쿠키 정보 읽기
        - 속성의 처리(데이터 공유)

- 클라이언트와 요청 관련 정보 읽기
    - 메서드

| 메서드                      | 리턴 타입    | 기능                                                   |
|--------------------------|----------|------------------------------------------------------|
| `getRemoteAddr()`        | `String` | 클라이언트 컴퓨터의 IP 주소를 리턴                                 |
| `getContentLength()`     | `long`   | 클라이언트가 전송한 요청 몸체의 길이를 리턴<br>길이를 알 수 없는 경우에는 `-1`을 리턴 |
| `getCharacterEncoding()` | `String` | 클라이언트가 요청 몸체에서 데이터를 전송할 때 사용한 문자열 인코딩을 리턴            |
| `getContentType()`       | `String` | 클라이언트가 요청 몸체를 전송할 때 사용한 문서 타입을 리턴                    |
| `getProtocol()`          | `String` | 클라이언트가 요청에서 사용한 프로토콜을 리턴                             |
| `getMethod()`            | `String` | 클라이언트가 데이터를 전송할 때 사용한 요청 방식을 리턴                      |

- 서버 관련 정보 읽기
    - 메서드

| 메서드                | 리턴 타입    | 기능                           |
|--------------------|----------|------------------------------|
| `getContextPath()` | `String` | JSP 페이지가 속한 웹 애플리케이션의 경로를 리턴 |
| `getServerName()`  | `String` | 연결할 때 사용한 서버 주소를 리턴          |
| `getServerPort()`  | `int`    | 연결할 때 사용된 서버의 포트 번호를 리턴      |

- HTML 폼과 request 객체
    - HTML 폼
        - 사용자가 데이터를 입력하기 위한 틀
            - 텍스트 필드, 체크 박스, 라디오 버튼, 제출 버튼 등의 요소를 포함
        - 요청을 보낸 수 있으며, 요청 시 서버로 데이터를 전송할 수 있음
            - GET 또는 POST 방식으로 데이터를 전송할 수 있음
    - 폼과 request 객체
        - 폼에 입력된 정보는 파라미터로 전송됨
            - 파라미터는 클라이언트가 서버로 보내는 이름-값 쌍 형태의 데이터
        - JSP 페이지에서는 request 객체를 이용하여 사용자가 보낸 파라미터를 읽을 수 있음
            - <%= request.getParameter("name")%>

- 요청 파라미터 읽기
    - 메서드

| 메서드                               | 리턴 타입         | 기능                                                           |
|-----------------------------------|---------------|--------------------------------------------------------------|
| `getParameter(String name)`       | `String`      | 입력 폼을 통해 전송된 이름이 `name`인 파라미터 값을 리턴. 해당 이름이 없을 경우 `null`을 리턴 |
| `getParameterValues(String name)` | `String[]`    | 이름이 `name`인 파라미터의 모든 값을 배열로 리턴. 해당 이름이 없을 경우 `null`을 리턴      |
| `getParameterNames()`             | `Enumeration` | 웹 브라우저가 전송한 파라미터의 이름을 리턴                                     |
| `getParameterMap()`               | `Map`         | 웹 브라우저가 전송한 파라미터를 Map 형식으로 리턴. Map은 ``<파라미터이름, 값>`` 으로 구성됨   |

- 요청 헤더 정보 읽기
    - 메서드

### (3) response 내장 객체

- 응답과 response 내장 객체
    - response 내장 객체
        - JSP에서 응답을 작성할 때 사용하는 내장 객체
            - 요청이 오면 생성되고, 처리가 끝나면 소멸됨
        - HttpServletResponse 인터페이스를 구현한 객체
    - 주요 기능
        - HTTP 응답 헤더 정보의 설정하기
        - 요청을 다른 페이지로 강제 이동 시키기
        - 응답에 쿠키 추가하기
        - 상태 코드 설정하기
        - 응답 몸체를 만들기 위한 출력 스트림 객체 생성
            - getWriter() 또는 getOutputStream()
- 응답 헤더 정보 설정하기
    - 메서드

| 메서드                                    | 리턴 타입     | 기능                                                       |
|----------------------------------------|-----------|----------------------------------------------------------|
| `addHeader(String name, String value)` | `void`    | `name` 헤더에 `value`를 값으로 추가                               |
| `addIntHeader(String name, int value)` | `void`    | `name` 헤더에 정수 값 `value`를 추가                              |
| `setHeader(String name, String value)` | `void`    | `name` 헤더의 값을 `value`로 변경                                |
| `setIntHeader(String name, int value)` | `void`    | `name` 헤더의 값을 정수 값 `value`로 변경                           |
| `containsHeader(String name)`          | `boolean` | 이름이 `name`인 헤더를 포함하고 있을 경우 `true`, 그렇지 않을 경우 `false`를 리턴 |
| `setContentType(String type)`          | `void`    | 응답 헤더에 `Content-Type` 값을 포함시켜 응답 몸체의 형식(MIME)을 정함        |

- 웹 브라우저 캐시와 응답 헤더
    - 웹 브라우저 캐시
        - 웹 브라우저는 서버 응답을 캐시에 저장하여 동일 요청 시 재사용
        - 장점: 변경이 적은 사이트의 경우 응답 속도 향상
        - 단점: 내용이 자주 변경되는 사이트는 변경 사항이 반영되지 않을 수 있음
    - 캐시 제어를 위한 HTTP 응답 헤더
        - Cache-Control (HTTP 1.1이상)
            - "no-cache": 저장은 가능하지만, 다음 요청 시 서버에 변경 여부 확인
            - "no-store": 캐시에 저장 자체를 금지
        - Pragma (HTTP 1.0)
        - HTTP 1.0 브라우저 호환성을 위해 두 헤더 모두 설정 권장
- 다른 페이지로 강제 이동시키기
    - response.sendRedirect(String location)
        - 다른 페이지로 강제 이동시키는 리다이렉트 기능
            - 응답이 커밋되기 전에만 가능
        - 동작 방식
            - 서버가 첫 요청에 대해 HTTP 응답(상태 코드 302)을 보냄
                - 응답 헤더의 Location 필드에 이동할 URL을 포함
            - 브라우저가 해당 URL로 새로운 요청을 보냄
                - 두번의 요청과 응답이 발생
    - 특징
        - 클라이언트 측 이동이므로, 브라우저 주소창의 URL이 변경됨
        - 처음 요청의 request 객체와 속성(attribute)이 유지되지 않음
            - 반면 `<jsp:forward>`는 서버 내부에서 페이지를 이동시키며, 같은 request와 response 객체를 사용(한 번의 요청과 응답)
        - 이동할 URL에 한글, 특수 문자가 있으면 인코딩이 필요함
            - URLEncoder.encode(String s, "UTF-8")



