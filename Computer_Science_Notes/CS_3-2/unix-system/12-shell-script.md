# # UNIX 시스템

## 12. 셸 스크립트 (2)

- 컴퓨터과학과 김희천 교수님

### (1) 선택 구조

- 제어 구조
    - 셸 스크립트에서 실행을 제어하기 위해 선택과 반복 구조를 사용함
    - if 명령, for 명령, case 명령, while 명령, until 명령
- if 명령(1)
    - 프로그래밍 언어에서 if 문의 기능을 수행하는 복합 명령
    - 문법
        - if command...; then
        - elif command...; then
        - else command
        - fi
    - 세미콜론(;)은 같은 라인에서 다른 단어(then, elif, else, fi 등)와 구분이 필요할 때 사용함
    - if 다음의 명령을 실행하여 참이면 then 다음의 명령을 실행함 (if 명령은 종료됨)
        - if나 elif 다음에 조건 검사를 위한 test 명령을 사용할 수 있음
        - if나 elif 다음에 여러 명령이 나오면 마지막 명령의 종료 상탯값으로 참고 ㅏ거짓을 구분함
        - 종료 상탯값 0은 성공적 종료를 의미하며 참으로 간주함
    - 거짓이면 elif 다음의 명령을 실행하여 참/거짓을 판단하고 실행함
    - 만족되는 것이 없으면 else 다음의 명령을 실행함
- test 명령
    - 조건 검사를 위해 사용하는 명령
        - 조건이 만족되면 종료 상탯값으로 0(참)을, 아니면 1(거짓)을 리턴함
    - test expression 또는 [expression]
        - expression은 파일의 상태 검사, 문자열의 비교, 정수 비교를 위한 조건 수식
        - 대괄호와 expression 사이에 공백이 있어야 함
- test 명령에서 수식에 사용되는 연산자

| 연산자                     | 설명                                                |
|-------------------------|---------------------------------------------------|
| `file1 -nt file2`       | 파일1이 파일2보다 **새로운 것**인가                            |
| `file1 -ot file2`       | 파일1이 파일2보다 **오래된 것**인가                            |
| `-d file`               | 파일이 **디렉터리**인가                                    |
| `-e file`               | 파일이 **존재**하는가                                     |
| `-f file`               | 파일이 존재하고 **정규 파일**인가                              |
| `-s file`               | 파일이 존재하고 **크기가 0보다 큼**(not empty)                 |
| `-r file`               | 파일이 **읽기 가능**한가                                   |
| `string1 > string2`     | 문자열1이 문자열2보다 **큰가**(사전식). `test` 명령 사용 시 `\>` 사용  |
| `string1 < string2`     | 문자열1이 문자열2보다 **작은가**(사전식). `test` 명령 사용 시 `\<` 사용 |
| `string1 = string2`     | 문자열1이 문자열2와 **같은가** (`==`도 사용 가능)                 |
| `string1 != string2`    | 문자열1이 문자열2와 **다른가**                               |
| `integer1 -eq integer2` | 정수1과 정수2가 **같은가**                                 |
| `integer1 -ne integer2` | 정수1과 정수2가 **다른가**                                 |
| `integer1 -le integer2` | 정수1이 정수2보다 **작거나 같은가**                            |
| `integer1 -lt integer2` | 정수1이 정수2보다 **작은가**                                |

- case 명령
    - 다중 선택을 지원하는 복합 명령
        - Java 언어에서 switch 문의 의미와 거의 같음
    - 문법
        - case word in
            - [pattern[|pattern]...) command...;; ]...
        - esac
    - 설명
        - word 부분을 먼저 확장하고 pattern과 매칭되는지 검사함
        - 매칭이 이루어지면 상응하는 명령이 수행됨
        - 일단 매칭이 이루어지면 이후의 매칭 시도는 없음
        - pattern에서 *는 프로그래밍 언어에서 'default' 키워드를 사용하는 것과 같음
- case 명령에서 패턴의 사용 예

| pattern)       | 설명( word 가 다음과 같은 경우 패턴 매칭 )                       |
|----------------|----------------------------------------------------|
| `a)`           | 문자 `a` 인 경우                                        |
| `[[:alpha:]])` | 알파벳 문자 1개인 경우                                      |
| `???)`         | 임의의 **세 글자**인 경우                                   |
| `*.txt)`       | `.txt` 로 끝나는 경우                                    |
| `[aeiou])`     | 모음에 해당하는 영문 소문자 1개인 경우                             |
| `[ABE][0-9])`  | 앞 글자가 `A/B/E` 중 하나이고, 다음 글자가 숫자인 **두 글자**          |
| `*)`           | 임의 길이의 어떤 문자열이든 매칭됨 *(case 문에서 마지막 패턴으로 두는 것을 권장)* |

### (2) 반복 구조

- for 명령(1)
    - 모든 데이터를 한 차례씩 처리하는 제어구조
        - for variable [in word...]; do
            - command...
        - done
    - 설명
        - word... 부분 (값의 목록)을 먼저 확장함
        - word...에 존재하는 값을 순차적으로 변수 variable에 대입하고 do와 done 사이의 명령을 수행함
        - word 부분이 없다면 in "$@"가 있는 것으로 가정함
- for 명령(2)
    - C나 Java 프로그래밍에서 사용하는 형태
        - for ((exp1; exp2; exp3)); do
            - command
        - done
    - 설명
        - exp1~exp3은 수식으로 어떤 것도 생략이 가능함
        - exp1는 제어 변수의 초기화를 위해 한 번 수행됨
        - exp2가 참인 동안 "명령과 exp3"이 반복 수행됨
- while 명령
    - 조건이 참인 동안 명령을 반복하여 수행함
        - while command...; do
            - command...
        - done
    - 설명
        - while 다음에 나오는 명령을 실행하여 참 또는 거짓을 판단함
        - if 명령과 마찬가지로 종료 상탯값이 0이면 참으로 판단
        - 조건 비교를 위해 while 다음에 test expression 또는 [expression]을 자주 사용함
- for 명령과 while 명령
    - C언어 형식의 for 명령(2)를 다음과 같이 변환할 수 있음
        - ((exp1))
            - while ((exp2)); do
                - command...
                - ((exp3))
            - done
    - 설명
        - ((expression))은 수식 계산에 사용되는 복합 명령
        - let "expression"과 동일하며 test 명령 대신에 사용할 수 있음
            - 조건 비교를 위해 test expression 또는 [expression]와 함께 자주 사용함
        - while 다음의 ((expression))에서 수식 결과가 0이 아닌 경우, 종료 상탯값이 0이 되며 참으로 판단
- until 명령
    - 조건이 만족될 때까지 (거짓인 동안) 명령을 반복하여 수행함
        - until command...; do
            - command...
        - done
    - 설명
        - until 다음에 나오는 명령이 참이 될 때까지 반복함
            - 즉, 거짓인 동안 반복하게 됨
        - 조건을 표시하기 위해 test expression, [expression] 또는 ((expression))을 사용할 수 있음
