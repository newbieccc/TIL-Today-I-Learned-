# # UNIX 시스템

## 11. 셸 스크립트 (1)

- 컴퓨터과학과 김희천 교수님

### (1) 셸 스크립트 개요

- 셸
    - 명령어 해석기
        - 사용자에게 인터페이스를 제공
        - 셸은 명령어에 상응하는 프로그램을 실행시키고, 완료 후 결과를 스크린에 보여줌
    - 스크립트 언어, 프로그래밍 언어
        - 함수, 변수 등의 프로그래밍 요소를 사용할 수 있음
        - 반복문, 조건문 등의 제어 구조를 사용할 수 있음
        - 셸은 셸 스크립트 프로그램에 있는 명령 행을 제어 구조에 따라 해석하고 실행시킴
        - 파일(셸 스크립트)에 명령을 저장하여 자동, 반복적으로 실행 가능
- 셸의 종류
    - Bash 셸(리눅스 배포판의 기본 셸), Csh/Tcsh 셸, Ksh 셸, Zsh 셸, Fish 셸 등
    - 텍스트 모드 또는 GUI 환경에서 터미널을 띄우고 셸 명령을 실행함
- 셸 스크립트(1)
    - 셸 명령어의 집합으로 이루어진 실행 가능한 프로그램(텍스트 파일)
        - 셸이 스크립트 파일의 내용을 읽어 처리함
        - 선택/반복 등의 프로그래밍 구조를 사용할 수 있음
        - 셸에서 사용할 수 있는 모든 기능을 포함할 수 있음
            - 함수나 변수의 선언, 파이프 입출력 리다이렉션 등
        - 긴 작업, 반복적으로 일어나는 작업을 셸 스크립트로 작성할 수 있음
        - 셸 스크립트를 새로운 하나의 명령어처럼 사용할 수 있음
- 셸 스크립트의 실행 방법
    - bash script_file
        - bash 명령을 사용하며, 스크립트 파일에 실행 권한을 추가할 필요가 없음
        - 명령행에서 script_file 다음에 인수를 추가할 수 있음(모든 방법이 마찬가지)
        - 서브 셸을 새로 생성하여 스크립트를 실행함
    - ./script_file
        - 스크립트 파일의 이름을 명령어처럼 사용하는 방법
        - 스크립트 파일에 실행 권한을 추가해야 함
        - PATH 환경 변수에 설정된 디렉터리에서 스크립트 파일을 찾음
        - 스크립트 파일의 첫 행에서 #! 다음에 해석기(/bin/bash)를 지정함
        - 서브 셸을 새로 생성하여 스크립트를 실행함
    - source script_file 또는 . script_file
        - source는 셸의 내장 명령이며 현재 사용 중인 셸 환경에서 스크립트 파일을 실행 함
        - source 명령 대신에 도트(.) 명령을 사용할 수 있음
- 셸 스크립트 문법
    - # 이후 (같은 행에서) 나오는 내용은 주석으로 처리됨
    - $0은 스크립트 파일의 이름으로 확장됨
        - source 명령으로 실행하는 경우는 셸의 이름(bash)으로 확장됨
    - $1은 첫 번째 인수, $2는 두 번째 인수로 확장됨
    - 스크립트가 복잡하다면, 중간중간에 적절한 echo 명령을 넣는 것이 좋음
    - 변수=값을 사용하여 변수에 값을 지정하고 $변수를 사용하여 값을 추출할 수 있음
        - 등호(=)의 좌우에 공백이 있으면 안됨
    - 참고
        - bash -x script_file과 같이 실행하면 실행 전에 명령 자체가 화면에 출력 됨

### (2) 변수의 사용

- 셸 스크립트에서 변수의 사용
    - 선언 없이 변수를 사용할 수 있음
        - 변수에 값을 지정하는 방법은 변수이름=값 (공백이 있으면 안 됨)
        - 예: MYCOLOR=blue
        - 변수 확장 $변수는 변수의 값을 추출하는 것
        - 예: echo $PATH
    - 변수의 값은 기본적으로 문자열로 취급됨
        - 연산이 필요하고, 변환이 가능한 경우에 정수로 다루어짐
    - 변수의 이름 작명
        - 대소문자의 구별
        - 영문자, 숫자, 언더스코어(_) 문자로 구성
        - 첫 자는 숫자가 될 수 없음

| 사용 예                  | 설명                                                                                 |
|-----------------------|------------------------------------------------------------------------------------|
| `a=ls`                | 변수 `a`에 문자열 `"ls"`를 대입                                                             |
| `b="A string"`        | 따옴표를 사용하여 **공백을 가진 문자열**을 대입                                                       |
| `c="A string and $b"` | `$b`를 **변수 확장**한 후 문자열을 대입                                                         |
| `d=$(ls \| wc -l)`    | `$( … )`는 **명령 치환**의 의미. 괄호 안의 명령을 실행한 후 결과를 대입                                    |
| `e=$((5*7))`          | `$(( … ))`는 **수식 확장**의 의미. 괄호 안의 수식을 계산한 결과를 대입                                    |
| `f="\t\tA string\n"`  | **이스케이프 문자**(백슬래시 `\` 사용) 예시                                                       |
| `g=5 h="A string"`    | 한 행에서 **두 개 변수**를 동시에 대입하는 예                                                       |
| `i=${b}1`             | 변수 이름을 **중괄호로 묶어** 뒤따르는 문자와 분리. 결과는 `"A string1"` (실제 `$b`는 `${b}`로 확장)            |
| `$a`                  | 먼저 **변수 확장**이 일어나고, 셸이 이를 **명령어로 해석**하여 실행 (`a=ls`라면 `ls` 실행)                      |
| `$a=$e`               | 확장 결과가 `ls=35`처럼 되어 셸이 이를 **하나의 명령어**로 처리하려고 해 **오류 발생**. 필요 시 `eval "$a=$e"`처럼 사용 |

- 명령 행 인수
    - 셸이 스크립트를 처리할 때 사용되는 인수
        - 스크립트 실행에 필요한 입력값이 있을 수 있음
    - $0은 스크립트 파일의 이름으로 확장됨
    - 나머지를 위치 매개변수(positional parameter)라 하며 $1, $2, $3등은 이러한 인수를 의미함

- 특별한 매개 변수
    - 명령 행 인수와 관계가 있는 특별한 변수
    - 변수의 값을 참조만 할 수 있음

| 특수 변수 | 설명                                                       |
|-------|----------------------------------------------------------|
| `$*`  | 모든 위치 매개변수(`$0` 제외)를 **하나의 문자열**로 확장. 예: `"$1 $2 $3 …"`  |
| `$@`  | 모든 위치 매개변수를 **여러 개의 큰따옴표로 각각** 확장. 예: `"$1" "$2" "$3" …` |
| `$$`  | 현재 셸의 **프로세스 ID(PID)** 로 확장                              |
| `$#`  | **위치 매개변수의 개수**로 확장                                      |
| `$?`  | **최근에 실행된 포어그라운드 명령의 종료 상태값**으로 확장 (성공 시 `0`)            |
| `$!`  | **최근에 실행된 백그라운드 명령의 PID** 로 확장                           |

- read 명령
    - 키보드로부터 한 라인을 읽은 후, 개별 단어를 상응하는 변수에 저장함
        - 대화식으로 스크립트를 실행시킬 수 있음
    - read [options] [variable...]
        - 첫 번째 변수에 첫 번째 단어를, 두 번째 변수에 두 번째 단어를 저장
        - 변수 개수가 적으면, 마지막 변수에 나머지 모두를 저장
        - 남는 변수가 있으면 빈 문자열이 됨
        - 변수의 이름을 사용하지 않으면 셸 변수 REPLY에 저장됨
        - 옵션 -p promt는 입력을 위한 프롬프트를 지정함

### (3) 함수의 사용

- 함수
    - 함수는 셸 스크립트에서 반복적으로 사용되는 명령의 묶음
    - 셸 스크립트에서 함수를 정의할 수 있음
        - 정의되어 있는 함수를 호출하여 사용함
    - 셸에서 함수를 호출하면, 호출한 셸 내에서 실행됨
- 함수의 사용(호출) 방법
    - 함수가 정의된 셸 스크립트 내에서 함수를 호출하여 사용할 수 있음
    - source 명령이나 도트(.) 명령으로 함수가 정의된 셸 스크립트를 실행하면 셸 환경에 함수 정의가 추가됨. 그러면 같은 셸에서 함수 이름을 셸 명령어처럼 사용
        - set 명령으로 함수 정의를 확인하고 unset name으로 삭제할 수 있음
        - 함수가 정의되어 있으면 함수를 셸 명령어처럼 사용할 수 있음
- 함수 정의 방법
    - return 또는 return n 문은 함수를 종료하는 문장으로 종료 상태값을 리턴할 수 있음(n이 생략되면 직전 명령의 종료 상태 값을 리턴)
    - 함수 정의를 항상 사용하려면 .bashrc에 넣는 것이 좋음
        - 에일리어스 설정도 마찬가지
        - 셸이 시작될 때 항상 .~/.bashrc가 실행되기 때문임
