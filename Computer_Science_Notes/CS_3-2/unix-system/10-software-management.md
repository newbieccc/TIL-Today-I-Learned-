# # UNIX 시스템

## 10. 소프트웨어 관리

- 컴퓨터과학과 김희천 교수님

### (1) 패키지 관리

- 소프트웨어 패키지의 관리
    - 소프트웨어를 설치, 업데이트 및 삭제하는 등의 관리 작업
    - 패키지 관리 도구를 사용하는 것이 편리함
        - 리눅스 초기에는 소스 프로그램을 가져와 적당한 디렉터리 구조를 만들고 컴파일하고 링크하며 환경 설정 작업을 해야 했음
        - 컴파일 되어 있는 프로그램과 패키지를 다루고, 관리 도구를 사용하는 것이 효율적
    - 리눅스 배포판에 따라 패키징 방법이 다름ㅓ
        - 소프트웨어의 배포를 위해 표준 방법이 필요함
        - 데비안 계열은 DEB(.deb), 레드햇 계열은 RPM(.rpm) 방법
        - 도구를 사용하거나 '패키지 파일'을 찾아 다운로드 받은 후 설치함
        - 패키지 파일은 패키지를 구성하는 파일들을 묶어 압축한 파일
- 패키지 파일과 저장소
    - 패키지 관리의 기본 단위는 '패키지 파일'
    - 바이너리 프로그램, 설정 파일, 패키지의 메타데이터, 설치 스크립트 등으로 구성됨
        - 메타데이터는 패키지에 관한 정보
            - 패키지 이름, 버전, 릴리스, 아키텍처, 패키지 요약과 설명, 저작자, 라이선스, 설치를 위해 필요한 라이브러리나 다른 패키지 정보 등
        - 설치/업데이트/삭제 또는 환경 설정을 위해 스크립트 파일도 필요
    - 패키지 저장소는 배포용 패키지를 저장하고 관리하는 사이트
        - 고수준 패키지 관리 도구는 '저장소 설정 파일'을 통해 많은 패키지 저장소를 검색할 수 있음
- 패키지 의존성
    - 어떤 패키지의 실행을 위해 다른 패키지가 필요할 수 있음
        - 공유 라이브러리가 필요하다면 패키지가 그것에 의존적(또는 종속적)이라고 함
    - 패키지를 설치할 때 '선행 패키지'가 이미 설치되어 있어야 하나, 아니라면 함께 설치해야 함
        - 저수준 패키지 관리 도구 RPM은 해당 패키지만 설치하거나 삭제
        - 고수준 패키지 관리 도구 YUM 또는 DNF는 의존성 문제를 해결
            - 메타 데이터를 읽고 필요한 선행 패키지를 함께 설치함

### (2) RPM 패키지 관리자

- RPM
    - RPM은 레드햇 계열 리눅스에서 패키지 파일의 표준 형식
        - 패키지 파일의 이름은
            - <패키지 이름><버전-릴리스>.<배포판>.<아키텍처>.rpm
        - 예를 들명 firefox-102.8.0-2.el_1.x86_64.rpm
            - 패키지 파일의 확장자가 .rpm
            - 릴리스 번호는 해당 버전에서 몇 번째 개선된 것인가를 의미
            - 배포판 정보는 해당 배포판과 호환됨을 의미
            - 아키텍처는 설치가 가능한 프로세서 아키텍처를 의미
    - RPM은 RPM Package Manager을 의미하기도 함
        - 패키지가 설치되면 '로컬 RPM 데이터베이스'에 정보가 저장됨
        - rpm -qa 또는 rpm -qi firefox와 같이 설치된 패키지의 정보를 질의할 수 있음
- rpm 명령(1)
    - 패키지를 설치, 업데이트, 삭제하거나 정보를 확인하는 명령
    - rpm [options] [packages]
        - 옵션은 크게 설치(-i), 업데이트(-U), 삭제 (-ㄷ), 질의(-q)로 분류됨
            - 각각에 해당 옵션의 서브 옵션을 추가로 붙일 수 있음
        - 설치나 업데이트를 할 때는 packages에 패키지 파일의 이름(.rpm)을 지정함
        - 질의를 할 때는 보통 packages에 패키지의 이름만 사용함
    - 패키지를 설치할 때 선행 패키지가 설치되어 있지 않으면 '의존성 문제'로 설치가 실패함
        - RPM 패키지 관리자를 사용할 때는 '선행 패키지'를 찾아 미리 설치해야 하는 문제가 있음
        - 설치하고자 하는 'RPM 파일'을 가지고 있거나 다운로드 받을 수 있어야 함

| rpm 명령과 옵션              | 설명                                                 |
|-------------------------|----------------------------------------------------|
| `rpm -i package_file`   | RPM 패키지 파일을 가지고 소프트웨어를 설치                          |
| `rpm -e package_name`   | 패키지를 삭제함. **종속성 문제**가 생긴다면 삭제되지 않음                 |
| `rpm -qa`               | 설치되어 있는 **모든**(`-a`) 패키지를 나열함                      |
| `rpm -qi package_name`  | 패키지 이름, 버전, 설명 등의 다양한 정보(`-i`)를 출력함                |
| `rpm -qf file`          | 지정 파일(`-f`)을 **포함하는 패키지**를 출력함                     |
| `rpm -ql package_name`  | 설치된 패키지에 포함되어 있는 **모든 파일**을 나열(`-l`)               |
| `rpm -qc package_name`  | 설치된 패키지의 **설정(`-c`) 파일**을 나열함                      |
| `rpm -qR package_name`  | 패키지가 **의존(`-R`)**하고 있는 패키지 목록을 보여줌                 |
| `rpm -qlp package_file` | **설치되지 않은** RPM 패키지(`-p`)에 포함되어 있는 모든 파일을 나열(`-l`) |

### (3) DNF 패키지 관리자

- YUM
    - Yellowdog Update Manager의 약자
    - RPM 방법에 기초한 자동 패키지 설치, 업그레이드 및 삭제 도구
        - 레드햇 리눅스 계열 배포판에서 주로 사용됨
        - RPM 명령의 어려운 부분인 패키지 의존성 문제를 해결
        - 선행 패키지를 검색하여 자동을 설치함
        - 저장소 기반의 설치 기능을 제공하는 고수준 패키지 관리 도구
- DNF
    - Dandified YUM의 약자로 YUM의 차세대 버전
    - YUM과 호환되는 명령 행 기반, 저장소 기반의 패키지 관리 도구
        - 빠른 설치, 효율적 의존석 처리, 직관적 명령과 처리, 패키지 무결서 ㅇ관리 등에서 향ㅎ상된 기능을 제공
        - 최신 리눅스 배포판의 기본 패키지 관리자
    - 저장소 목록을 유지하여 설치 가능한 패키지를 검색
        - /etc/dnf/dnf.conf 또는 /etc/yum.repos.d 디렉터리에 있는 저장소 설정 파일(.repo)에 저장소 정보를 저장
        - dnf repolist --enabled 명령으로 활성화된 저장소를 확인할 수 있음
- dnf 명령
    - dnf [options] command
        - command는 dnf의 서브 명령
        - command의 인수로 패키지를 지정할 때 name, name.arch, name-ver, name-ver-rel, name-ver-rel.arch 등의 형태를 사용함
    - 설치를 위한 수행 과정
        - 설정 파일을 읽음
        - dnf 저장소에 있는 모든 패키지의 메타데이터가 로컬 캐시 디렉터리에 저장됨
        - 패키지의 의존성을 확인한 후 필요한 패키지를 저장소로부터 다운로드 받음
        - 패키지에 포함된 파일을 적당한 디렉터리에 복사하여 설치함
        - 설치된 패키지의 정보를 로컬 'RPM 데이터베이스'에 저장
- dnf 명령의 사용 예(1)
    - dnf search string [strings]
        - 패키지 이름이나 요약에서 문자열을 검색하여 패키지를 찾음
        - dnf search web server
    - dnf install package [package]
        - 패키지를 설치함
        - dnf install emacs
    - dnf update [packages]
        - 패키지를 업데이트함
    - dnf remove package [packages]
        - 패키지를 삭제함
    - dnf reinstall package [packages]
        - 패키지를 다시 설치함
    - dnfinfo [options] [packages]
        - 패키지의 설명(description)과 요약 (summary) 정보를 출력함
        - dnf info firefox
- dnf 명령의 사용 예(2)
    - dnf list available [packages]
        - 설치되어 있지 않은 가용 패키지의 목록을 출력함
    - dnf list installed [packages]
        - 설치되어 있는 패키지 목록을 출력함
        - dnf list installed emacs
    - dnf deplist package [packages]
        - 패키지가 의존하는 요소와 그것을 제공하는 패키지를 나열함
    - dnf repolist [options]
        - 저장소 목록을 나열함
        - dnf repolist enabled 명령은 활성화된 저장소 목록을 출력함
    - dnf history [info [undo] ..]
        - 패키지의 설치와 삭제 이력이 /var/log/dnf.log 파일에 기록됨
        - dnf history 명령으로 이력을 확인할 수 있음
        - dnf history info 5 명령으로 해당 dnf 명령의 자세한 내용을 확인함
        - dnf history undo 5 명령으로 해당 명령을 취소 할 수 있음

### (4) 압축

- 파일 압축
    - 파일 압축 시스템 파일이나 데이터를 백업할 때 '파일 압축'이 필요함
    - 압축을 통해 디스크 공간을 절약하거나 데이터 전송 시간을 줄일 수 있음
    - 다양한 압축 기술이 존재
        - 공간 효율과 압축 속도에서 차이가 남
        - gzip, bzip2, xz, zip 등
- gzip 명령
    - gzip은 압축 파일의 형식이자 파일의 압축과 해제를 위한 프로그램
        - 가장 널리 사용되는 리눅스의 기본 압축 프로그램
        - 초기 Unix 시스템의 압축 프로그램을 GNU 프로젝트에서 수정한 버전
    - gzip [options] [files]
        - 압축한 후 원본 파일은 .gz 확장자를 갖는 파일로 대체됨
        - gzip file을 수행하면 file은 없어지고 file.gz이 만들어짐
    - 옵션

| 옵션        | 설명                                              |
|-----------|-------------------------------------------------|
| `-c`      | 결과를 표준 출력으로 보내고 원본 파일은 그대로 유지됨                  |
| `-d`      | 압축을 풀 때 사용하며 `gunzip` 명령과 같음                    |
| `-r`      | 인수로 디렉터리가 주어지면 그 디렉터리의 **모든 파일을 재귀적으로** 탐색하여 압축 |
| `-t`      | 압축 파일의 **무결성**을 검사                              |
| `-v`      | 압축/해제하면서 **파일 이름과 압축률**을 출력                     |
| `-number` | 압축률(1~9)을 지정, **기본값은 6**                        |

- gunzip 명령
    - .gz, .Z, .tgz, .taz등의 확장자를 가진 압축파일을 풀고 확장자를 제거함 (.tgz은 .tar.gz, .taz는 .tar.Z을 의미)
- gzip과 gunzip 명령의 사용 예

| 명령/옵션                          | 설명                                            |
|--------------------------------|-----------------------------------------------|
| `gzip foo.txt`                 | 파일 `foo.txt.gz`를 만들고 **원본 파일은 삭제**됨           |
| `gzip -d foo.txt.gz`           | 압축을 풀어 **원본 파일을 복원**. 압축 파일은 없어짐              |
| `gzip *.txt`                   | 확장자가 `.txt`인 **모든 파일을 개별적으로 압축**              |
| `gunzip -d *.gz`               | **모든 `.gz` 압축 파일 해제** 후 원본 파일 생성              |
| `gzip -c file1 > bar.gz`       | `file1`을 압축하여 `bar.gz` 생성(**표준출력 사용, 리다이렉트**) |
| `gzip -c file2 >> bar.gz`      | `file2`를 압축하여 기존 `bar.gz`에 **추가(append)**     |
| `gunzip -c bar.gz`             | 압축을 풀어 **결과를 표준 출력**으로 보냄. 원본 `bar.gz`는 유지    |
| `gzip -c file1 file2 > baz.gz` | 두 파일을 **각각 압축한 뒤 연결**하여 `baz.gz` 생성           |

- bzip2 명령
    - 블록 정렬 압축 알고리즘을 사용한 파일 압축 프로그램
    - gzip과 유사하나 압축 효율이 매우 좋음(압축 속도는 느림)
        - 압축 후 파일 크기가 매우 작아짐(큰 파일에 사용하면 좋음)
    - 사용법은 gzip과 유사하며 압축 파일의 확장자로 .bz2를 사용
        - bzip2 file 은 원본 파일을 없애고 file.bz2를 만듦
        - bzip2 -k file는 원본 파일을 보존함
        - bzip2 -d file.bz2은 bunzip2 file.bz2과 같음
        - bunzip2 -c file.bz2는 bzcat file.bz2와 같음
- tar 명령
    - 여러 파일을 하나의 아카이브 파일로 묶거나 아카이브 파일에서 파일을 추출하는 명령
        - 아카이브는 백업 등의 목적으로 여러 파일을 하나로 묶은 것
    - tar mode [options] [tarfile] [pathnames...]
        - tarfile은 아카이브(묶음 파일)를 의미
        - pathname은 아카이브에 넣을 파일이나 디렉터리 아카이브 파일의 확장자는 보통 .tar를 사용함
        - 모드나 옵션을 사용할 때 대시(-)를 사용하지 않는 편임
    - 모드
        - A는 tar 파일을 아카이브에 추가
        - c는 새로운 아카이브의 생성
        - x는 아카이브로부터 파일을 추출
        - r은 아카이브에 파일을 추가
        - t는 아카이브에 포함된 파일의 목록을 출력
    - 옵션
        - f는 아카이브 파일을 지정(사용하지 않으면 아카이브 내용이 화면으로 출력됨)
        - v는 처리 과정에서 대상 파일을 보여줌
        - z는 tar 명령에서 gzip을 사용 (.tar.gz)
        - j는 tar 명령에서 bzip2를 사용 (.tar.bz2)
- tar 명령의 사용 예

| 명령/옵션                         | 설명                                                      |
|-------------------------------|---------------------------------------------------------|
| `tar cvf foo.tar *.c`         | 현재 디렉터리에서 `.c`로 끝나는 모든 파일을 `foo.tar`로 묶어 만들고 진행 결과를 출력함 |
| `tar tvf foo.tar`             | 아카이브 `foo.tar`에 있는 **파일 목록**을 출력함                       |
| `tar xvf foo.tar`             | 현재 디렉터리에 아카이브 `foo.tar`를 **풀어줌**                        |
| `tar cvf bar.tar backup/`     | 디렉터리 `backup/`의 내용을 묶어 아카이브 `bar.tar`를 만듦               |
| `tar cvfz baz.tar.gz backup/` | 위와 같으나 아카이브를 만들 때 **gzip**으로 **압축**하여 생성                |
| `tar xvfz baz.tar.gz`         | **gzip으로 압축된** 아카이브를 **풀어줌**                            |
